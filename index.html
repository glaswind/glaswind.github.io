<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>–ù–æ–≤–æ–≥–æ–¥–Ω—è—è –∫–æ–ø–∏–ª–∫–∞</title>
  <style>
    :root{--bg:#08121a;--card:#06232d;--accent:#ffd166;--glass:rgba(255,255,255,0.06)}
    html,body{height:100%;margin:0;font-family:Inter, system-ui, Arial, sans-serif;background:linear-gradient(180deg,#031018 0%, #032431 60%);color:#fff}
    .scene{min-height:100%;display:flex;align-items:center;justify-content:center;padding:32px}
    .card{width:420px;max-width:95%;background:linear-gradient(180deg,rgba(255,255,255,0.03), rgba(255,255,255,0.01));border-radius:18px;padding:22px;box-shadow:0 8px 30px rgba(2,6,23,0.7);border:1px solid rgba(255,255,255,0.03);position:relative;overflow:hidden}
    h1{margin:0 0 6px;font-size:20px;letter-spacing:0.6px}
    .subtitle{font-size:12px;color:#bfe8ff;margin-bottom:18px}
    .amount{font-size:40px;font-weight:700;margin:10px 0;display:flex;align-items:flex-end;gap:10px;cursor:pointer}
    .currency{font-size:18px;opacity:0.9}
    button{background:linear-gradient(180deg,var(--accent),#ffb84d);border:0;padding:10px 14px;border-radius:12px;font-weight:600;cursor:pointer;box-shadow:0 6px 18px rgba(255,160,40,0.18)}
    .btn-sec{background:transparent;border:1px solid rgba(255,255,255,0.08);padding:8px 12px;border-radius:10px;color:#dff6ff}
    .small{font-size:13px;color:#cbeffd;margin-top:12px}
    .tree{position:absolute;right:-60px;bottom:-80px;transform:rotate(12deg);opacity:0.16;width:380px}
    .footer{display:flex;justify-content:space-between;align-items:center;margin-top:14px}
    .muted{opacity:0.75;font-size:13px}
    .snow{pointer-events:none;position:absolute;inset:0;z-index:0}
    .flake{position:absolute;top:-10px;width:8px;height:8px;border-radius:50%;background:white;opacity:0.9;filter:blur(0.6px)}
    .danger{background:#ff6b6b}
    #addInput{width:100%;margin-top:14px;padding:10px;border-radius:10px;border:none;text-align:center;font-size:18px;background:rgba(255,255,255,0.08);color:#fff;outline:none;}
    #addInput:focus{background:rgba(255,255,255,0.15)}
    @media (max-width:420px){.card{padding:16px}}
  </style>
</head>
<body>
  <div class="scene">
    <div class="card" id="app" aria-live="polite">
      <h1>üéÑ –ù–æ–≤–æ–≥–æ–¥–Ω—è—è –∫–æ–ø–∏–ª–∫–∞</h1>
      <div class="subtitle">–õ–∏—á–Ω–∞—è –∫–æ–ø–∏–ª–∫–∞ ‚Äî —Ç–æ–ª—å–∫–æ –¥–ª—è —Ç–µ–±—è. –î–µ–Ω—å–≥–∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ –±—Ä–∞—É–∑–µ—Ä–µ.</div>
      <div class="amount" id="amountDisplay"><span id="amountValue">0</span><span class="currency">‚Ç¥</span></div>
      <div class="small">–ö–ª–∏–∫–Ω–∏ –ø–æ —Å—É–º–º–µ, —á—Ç–æ–±—ã –∏–∑–º–µ–Ω–∏—Ç—å –µ—ë —Å –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã.</div>
      <input type="number" id="addInput" placeholder="–í–≤–µ–¥–∏—Ç–µ —Å—É–º–º—É –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è..." />
      <div class="footer">
        <div class="muted">–ü–æ—Å–ª–µ–¥–Ω–µ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ: <span id="lastChange">‚Äî</span></div>
        <div>
          <button id="export" class="btn-sec">–≠–∫—Å–ø–æ—Ä—Ç</button>
          <button id="reset" class="btn-sec danger">–°–±—Ä–æ—Å</button>
        </div>
      </div>
      <svg class="tree" viewBox="0 0 200 200" xmlns="http://www.w3.org/2000/svg">
        <g>
          <ellipse cx="100" cy="180" rx="50" ry="8" fill="#0b3a2b" opacity="0.3"/>
          <path d="M100 12 L60 90 L140 90 Z" fill="#0f7b4f"/>
          <path d="M100 50 L50 140 L150 140 Z" fill="#0f8f5e"/>
          <path d="M100 90 L40 180 L160 180 Z" fill="#0fb071"/>
          <rect x="88" y="180" width="24" height="18" rx="4" fill="#67402a"/>
        </g>
      </svg>
      <div class="snow" id="snow"></div>
    </div>
  </div>
  <script>
    const K_AMOUNT = 'piggy_amount_v1';
    const K_HISTORY = 'piggy_history_v1';
    const $ = id => document.getElementById(id);
    function formatAmount(n){return Number(n).toLocaleString('ru-RU')}
    function nowISO(){return new Date().toISOString()}
    function readAmount(){return Number(localStorage.getItem(K_AMOUNT)||0)}
    function writeAmount(n){localStorage.setItem(K_AMOUNT,String(n))}
    function readHistory(){try{return JSON.parse(localStorage.getItem(K_HISTORY)||'[]')}catch(e){return []}}
    function writeHistory(h){localStorage.setItem(K_HISTORY,JSON.stringify(h))}
    function pushHistory(type,delta,before,after){const h=readHistory();h.unshift({t:nowISO(),type,delta,before,after});if(h.length>200)h.pop();writeHistory(h);$('lastChange').textContent=(new Date()).toLocaleString();}
    function updateUI(){$('amountValue').textContent=formatAmount(readAmount());}
    function setAmount(newAmount){const before=readAmount();const after=Math.max(0,Math.round(Number(newAmount)*100)/100||0);writeAmount(after);pushHistory('set',after-before,before,after);updateUI();}
    function addAmount(delta){const before=readAmount();const after=Math.max(0,before+Number(delta));writeAmount(after);pushHistory('add',delta,before,after);updateUI();}
    function showApp(){updateUI();
      $('amountDisplay').onclick=()=>{const span=$('amountValue');const oldVal=readAmount();const input=document.createElement('input');input.type='number';input.value=oldVal;input.style.fontSize='40px';input.style.width='150px';input.style.border='none';input.style.background='transparent';input.style.color='white';input.style.textAlign='center';input.onkeydown=e=>{if(e.key==='Enter'){setAmount(input.value);input.replaceWith(span);}if(e.key==='Escape'){input.replaceWith(span);}};span.replaceWith(input);input.focus();input.select();};
      const addInput=$('addInput');
      addInput.addEventListener('keydown',e=>{
        if(e.key==='Enter'){addAmount(addInput.value);addInput.value='';}
        if(e.key==='ArrowUp'){addInput.stepUp(1);} 
        if(e.key==='ArrowDown'){addInput.stepDown(1);} 
      });
      $('export').onclick=()=>{const data={amount:readAmount(),history:readHistory(),exportedAt:nowISO()};const blob=new Blob([JSON.stringify(data,null,2)],{type:'application/json'});const url=URL.createObjectURL(blob);const a=document.createElement('a');a.href=url;a.download='kopilka_backup_'+(new Date()).toISOString()+'.json';a.click();URL.revokeObjectURL(url);};
      $('reset').onclick=()=>{if(confirm('–°–±—Ä–æ—Å–∏—Ç—å –±–∞–ª–∞–Ω—Å? –≠—Ç–æ —É–¥–∞–ª–∏—Ç –≤—Å–µ –¥–∞–Ω–Ω—ã–µ.')){localStorage.removeItem(K_AMOUNT);localStorage.removeItem(K_HISTORY);location.reload();}};
      const hist=readHistory();$('lastChange').textContent=hist.length?(new Date(hist[0].t)).toLocaleString():'‚Äî';}
    function makeSnow(){const c=$('snow');for(let i=0;i<25;i++){const s=document.createElement('div');s.className='flake';s.style.left=(Math.random()*100)+'%';s.style.opacity=0.6+Math.random()*0.6;const size=4+Math.random()*8;s.style.width=size+'px';s.style.height=size+'px';s.animate([{transform:'translateY(-10vh)'},{transform:'translateY(120vh)'}],{duration:(6+Math.random()*8)*1000,iterations:Infinity,delay:Math.random()*-6000});c.appendChild(s);}}
    (function(){makeSnow();showApp();})();
  </script>
</body>
</html>
